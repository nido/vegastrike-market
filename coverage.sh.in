#!/bin/bash

make

TESTCASES="cargo cargohold productionoption factory"

if test -n "$1"
then
TESTCASES="$1"
fi

test -f ./cppunittest || make

for TEST in ${TESTCASES};
do
	echo Test ${TEST}
        lcov  --rc lcov_branch_coverage=1 -z --directory "@CMAKE_CURRENT_BINARY_DIR@" -o coverage${TEST}.info
        ./cppunittest ${TEST}
        lcov  --rc lcov_branch_coverage=1 -c -t ${TEST} --directory "@CMAKE_CURRENT_BINARY_DIR@" -o coverage${TEST}.info
        lcov  --rc lcov_branch_coverage=1 -e coverage${TEST}.info "@CMAKE_CURRENT_SOURCE_DIR@/*" -o codecoverage${TEST}.info
done

lcov  --rc lcov_branch_coverage=1 -o codecoverage.info -a codecoverage`echo ${TESTCASES} | sed "s/ /.info -a codecoverage/g"`.info


genhtml --branch-coverage --legend --show-details --title "Vegastrike Economy" --demangle-cpp codecoverage.info --output-directory "@CMAKE_CURRENT_BINARY_DIR@/coverage/"

echo `dirname "$0"`

